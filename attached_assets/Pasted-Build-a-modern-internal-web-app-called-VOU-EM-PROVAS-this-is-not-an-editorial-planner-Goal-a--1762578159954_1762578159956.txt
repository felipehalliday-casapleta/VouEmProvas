Build a modern internal web app called ‚ÄúVOU EM PROVAS‚Äù (this is not an editorial planner).
 Goal: a secure internal dashboard that reads/writes Google Sheets to list events (‚Äúprovas‚Äù), open their files, log views, and show media. Do not touch Google Drive folders ‚Äî ingestion/moves are handled by an external Cloud Run worker.
Tech & quality bar
Stack: Next.js (latest, App Router) + TypeScript + Tailwind + shadcn/ui.


UX: Neutral, production-grade dark mode by default (toggle to light). Clean cards, responsive grid, empty states, loading skeletons, toast feedback on mutations, keyboard accessibility.


Timezone: America/Sao_Paulo (server and UI). Dates displayed as DD/MM.


Auth, access control & security
Auth: Google OAuth (e.g., next-auth).


Allowlist: only users in ALLOWED_EMAILS (comma-separated). Reject anyone else server-side.


RBAC minimal: roles admin, editor, viewer (map by email in env or config).


Security: never expose secrets to the client; use server-only env vars; protect all (protected) routes via middleware; add basic CSP headers; strict type validation on API routes; sanitize inputs; close CORS.


Privacy: Logs page/section visible only to admin; it shows only UserEmail (no device/browser).


Data source: Google Sheets (Service Account) ‚Äî READ/WRITE
Use Google Sheets API v4 with a Service Account loaded from env vars. The app must:
READ from these tabs and WRITE to Arquivos (increment view counters) and append to Logs (view records).


Implement robust retry with small backoff on mutations.


SHEET_ID is provided via env. Share the sheet with the Service Account as Editor.
Tabs & columns (exact schema)
Use these exact header names:
Eventos
 EventID, Data, Nome, Tipo, Genero, DataExibicao, VersaoDescritivo, CriadoEm, AtualizadoEm, Local, AnotacoesDaCriacao, Status, DataISO
Arquivos
 FileID, EventID, TipoDocumento, Versao, ViewURL, DriveId, Origem, ViewCount, AtualizadoEm
Fotos
 FotoID, EventID, DriveId, Ordem, Imagem, Descricao, CriadoEm, AtualizadoEm, Ativo, Credito
Logs
 LogID, FileID, EventID, UserEmail, ViewedAt, ViewSource
Notes:
 ‚Ä¢ DataISO is authoritative for date comparisons (Hoje/Antes/Depois).
 ‚Ä¢ Origem is an enum {D, G, R}.
 ‚Ä¢ TipoDocumento is a controlled list: ‚ÄúDescritivo (PDF)‚Äù, ‚ÄúGabarito (PDF)‚Äù, ‚ÄúRoteiro (PDF)‚Äù, ‚ÄúResumo Em Video‚Äù, ‚ÄúMiniGame‚Äù, etc.
 ‚Ä¢ Do not persist IsHoje/IsFuturo/IsPassado in sheets. Compute at runtime.
Pages / navigation (App Router)
Create protected routes under app/(protected)/‚Ä¶, plus a sign-in route.
Hoje ‚Äî list Eventos where DataISO is ‚Äútoday‚Äù (America/Sao_Paulo). Card/list layout with quick filters by Tipo and search by Nome.


Antes ‚Äî Eventos where DataISO < today (sort desc by date).


Depois ‚Äî Eventos where DataISO > today (sort asc by date).


V√≠deos ‚Äî list from Arquivos filtered by TipoDocumento = "Resumo Em Video" (cards with title, chip for Versao, button ‚ÄúVisualizar‚Äù).


MiniGames ‚Äî list from Arquivos filtered by TipoDocumento = "MiniGame".


Evento (detalhe) ‚Äî show all Evento fields; below it:


Arquivos (cards): each card shows TipoDocumento, Versao, and has the Visualizar action (see below).


Fotos (gallery grid): order by Ordem, show Imagem (URL) and optional Credito. Hide items with Ativo = false.


Logs (admin-only): small table with only UserEmail (obscure other fields in UI), newest first.


Status ‚Äî read-only dashboard pulling simple fields from a Config tab if it exists (OK to render a placeholder if not). Show ‚Äúlast processed at/token‚Äù if available.


Busca global ‚Äî search Eventos by Nome/Tipo and Arquivos by TipoDocumento.


Important: On list pages (‚ÄúHoje/Antes/Depois‚Äù), do not show Arquivos inline. Files appear only on the Evento (detalhe) page.
Core action: ‚ÄúVisualizar‚Äù (front-initiated, Sheets write)
When a user clicks Visualizar on an Arquivo card:
Append a row to Logs:

 {
  LogID: uuid(),
  FileID,
  EventID,
  UserEmail: current user (from Google auth),
  ViewedAt: now() in America/Sao_Paulo (store ISO with -03:00),
  ViewSource: "WEB-APP"
}


Increment ViewCount for that FileID in Arquivos, set LastViewedAt (if exists) and LastViewedBy (if exists) accordingly; always update AtualizadoEm to now.


Open the ViewURL in a new tab.


Show toast feedback on success/error; retry mutations briefly on transient failures.


All mutations must be done server-side via API routes or server actions. Never expose Service Account creds to the browser.
Code structure
lib/sheets.ts ‚Äî typed client for Sheets with helpers:


getEventos() (with optional filters/sort in code)


getEventoById(eventId)


getArquivosByEvent(eventId)


getFotosByEvent(eventId)


appendLog(logRow)


incrementArquivoViewCount(fileId, userEmail) (atomic pattern: read row index, update ViewCount/LastViewedAt/By/AtualizadoEm)


lib/date.ts ‚Äî utilities for TZ and ‚ÄúisToday/isFuture/isPast‚Äù based on DataISO.


app/api/logs/append/route.ts and app/api/arquivos/increment/route.ts ‚Äî POST endpoints with zod validation, role checks, backoff on Sheets write, and clear error responses.


Auth middleware to enforce allowlist + role injection on request.user.


UI components using shadcn/ui (Navbar with tabs: Hoje, Antes, Depois, V√≠deos, MiniGames, Status; User menu with sign out and theme toggle).


Enums & validation
Strongly type Tipo, TipoDocumento, Origem. Use zod schemas on all API inputs.


Validate EventID, FileID as non-empty strings.


For safe UI, treat Imagem as external URL; if empty, render a placeholder.


Environment variables (.env.example)
Provide a real .env.example and load in dev/preview/prod:
# Auth (NextAuth + Google)
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=

# Access control
ALLOWED_EMAILS=felipe@exemplo.com,outro@exemplo.com
ROLE_ADMIN_EMAILS=felipe@exemplo.com

# Sheets
SHEET_ID=1iGTs0p3BbyhAZvm8AmGj7EsB3RcImcVDO-5W33CAmwg
GOOGLE_SERVICE_ACCOUNT_EMAIL=vou-em-provas-sa@scenic-impact-326208.iam.gserviceaccount.com
# Put the private key with \n line breaks escaped:
GOOGLE_SERVICE_ACCOUNT_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"

# App
TZ=America/Sao_Paulo

Scripts, build & deploy
package.json scripts
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start -p 3000",
    "lint": "next lint",
    "deploy:cloudrun": "echo 'Use gcloud builds submit && gcloud run deploy ...'",
    "deploy:firebase": "echo 'Use firebase deploy --only hosting'"
  }
}

Dockerfile (Cloud Run)
FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --no-audit --no-fund
COPY . .
RUN npm run build
EXPOSE 8080
ENV PORT=8080
CMD ["npm","start","--","-p","8080"]

README.md (must include)
Setup Google OAuth (Console), NextAuth config.


Share the Google Sheet with the Service Account as Editor.


Env vars table and how to paste the private key safely.


Dev (npm run dev), build (npm run build), run (npm start).


Cloud Run deploy commands and Firebase Hosting alternative (with rewrites for SSR).


Out of scope (enforce)
Do not implement Drive moves/export. That is handled by the external Cloud Run worker (vep-worker). This app only touches Google Sheets and opens ViewURL.


Deliverables
Running Next.js app with the pages/actions above.


Typed Sheets client with helpers and basic tests/stubs where applicable.


.env.example, Dockerfile, and README with setup/deploy steps.


Clean, accessible, dark-first UI with shadcn/ui components.


Routes & Architecture Glossary
üóÇ Estrutura geral / General structure
/login ‚Äî p√°gina de autentica√ß√£o via Google (OAuth).
 (Login page via Google OAuth.)


/(protected) ‚Äî rotas internas protegidas (requer login e e-mail autorizado).
 (All internal routes protected by auth middleware.)



üåÖ Main pages
Rota / Route
Fun√ß√£o (PT)
Function (EN)
Fonte / Source
/hoje
Lista eventos com DataISO = hoje.
Lists events where DataISO equals today.
Eventos
/antes
Lista eventos com DataISO < hoje (decrescente).
Lists past events (descending by date).
Eventos
/depois
Lista eventos com DataISO > hoje (crescente).
Lists future events (ascending by date).
Eventos
/evento/[eventId]
Detalhe do evento, com Arquivos, Fotos e Logs.
Event detail page showing files, photos and logs.
Eventos, Arquivos, Fotos, Logs
/videos
Lista arquivos com TipoDocumento = "Resumo Em Video".
Lists files with TipoDocumento = "Resumo Em Video".
Arquivos
/minigames
Lista arquivos com TipoDocumento = "MiniGame".
Lists files with TipoDocumento = "MiniGame".
Arquivos
/status
Mostra status da automa√ß√£o (aba Config).
Displays automation status (Config tab).
Config
/busca
Busca global por Nome/Tipo/TipoDocumento.
Global search by Name/Type/Document Type.
Eventos, Arquivos


‚öôÔ∏è Rotas de API / API Routes
Endpoint
A√ß√£o (PT)
Action (EN)
Opera√ß√£o no Sheets
POST /api/logs/append
Registra visualiza√ß√£o (Log).
Append a new view log entry.
Append row to Logs
POST /api/arquivos/increment
Incrementa contador de visualiza√ß√µes.
Increment file view counter.
Update Arquivos
GET /api/eventos
Lista eventos.
List all events with optional filters/sorting.
Read Eventos
GET /api/eventos/[eventId]
Retorna dados completos do evento.
Returns full event details (with relations).
Read from Eventos, Arquivos, Fotos, Logs
GET /api/status
Retorna status b√°sico da automa√ß√£o.
Returns simple automation/config status.
Read Config


üß© Estrutura de pastas / Folder structure (Next.js App Router)
app/
 ‚îú‚îÄ (public)/
 ‚îÇ   ‚îî‚îÄ login/              ‚Üí /login
 ‚îú‚îÄ (protected)/
 ‚îÇ   ‚îú‚îÄ hoje/               ‚Üí /hoje
 ‚îÇ   ‚îú‚îÄ antes/              ‚Üí /antes
 ‚îÇ   ‚îú‚îÄ depois/             ‚Üí /depois
 ‚îÇ   ‚îú‚îÄ evento/[eventId]/   ‚Üí /evento/:eventId
 ‚îÇ   ‚îú‚îÄ videos/             ‚Üí /videos
 ‚îÇ   ‚îú‚îÄ minigames/          ‚Üí /minigames
 ‚îÇ   ‚îú‚îÄ status/             ‚Üí /status
 ‚îÇ   ‚îî‚îÄ busca/              ‚Üí /busca
 ‚îî‚îÄ api/
     ‚îú‚îÄ logs/append/
     ‚îú‚îÄ arquivos/increment/
     ‚îú‚îÄ eventos/
     ‚îî‚îÄ status/

(Each directory inside app/ corresponds to a route; protected routes use middleware enforcing authentication and email allowlist.)

üîó Rela√ß√µes entre abas / Sheet relationships
Rela√ß√£o (PT)
Relationship (EN)
Eventos ‚Üí 1:N ‚Üí Arquivos
One Event has many Files
Eventos ‚Üí 1:N ‚Üí Fotos
One Event has many Photos
Eventos ‚Üí 1:N ‚Üí Logs
One Event has many Logs
Arquivos ‚Üí 1:N ‚Üí Logs
One File has many Logs


Reference Note:
I have attached the official document ‚ÄúVOU EM PROVAS ‚Äì AppSheet Version‚Äù as a reference only.
It describes the legacy structure, logic, and terminology of the previous version of this app.
Use it only to understand the context, naming conventions, and data model ‚Äî do not attempt to replicate the AppSheet implementation.
The new version must follow the full instructions provided in this prompt, using Next.js, Google Sheets API, and modern web best practices.
